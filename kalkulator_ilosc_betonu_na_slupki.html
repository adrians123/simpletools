<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kalkulator betonu pod słupek – uniwersalny</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#0b0c10;color:#f1f1f1;padding:24px;margin:0;}
    h1{font-size:22px;margin:0 0 10px}
    .card{background:#11131a;padding:18px;border-radius:12px;max-width:820px;margin:14px auto;border:1px solid #1f2333}
    label{display:block;margin:8px 0 4px}
    input,select{width:100%;padding:8px;border-radius:8px;border:1px solid #333;background:#0e1118;color:#fff}
    button{margin-top:14px;padding:10px 14px;border:none;border-radius:10px;background:#41c3ff;color:#000;cursor:pointer;font-weight:700}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .result{margin-top:16px;padding:12px;background:#1a1d29;border-radius:10px}
    .ok{color:#55d88a}.warn{color:#ffd36e}.bad{color:#ff7a7a}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    .muted{color:#a9b4c0}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{border-bottom:1px solid #2a2f44;padding:8px;text-align:left}
    .small{font-size:13px}
  </style>
</head>
<body>
  <h1>Kalkulator betonu pod słupek – uniwersalny</h1>
  <div class="card">
    <div class="grid">
      <div>
        <label>Jednostki:</label>
        <select id="units">
          <option value="cm" selected>centymetry</option>
          <option value="in">cale</option>
        </select>
      </div>
      <div>
        <label>Pojemność miarki (litry):</label>
        <input type="number" id="measure" value="5.0" step="0.1">
      </div>
      <div>
        <label>Średnica otworu:</label>
        <input type="number" id="diameter" value="25" step="0.1">
      </div>
      <div>
        <label>Głębokość otworu:</label>
        <input type="number" id="depth" value="50" step="0.1">
      </div>
      <div>
        <label>Pojemność wiadra do mieszania (litry):</label>
        <input type="number" id="bucket" value="45" step="1">
      </div>
      <div>
        <label>Margines (nie napełniaj do pełna):</label>
        <select id="headroom">
          <option value="0.8">20% luzu (zalecane)</option>
          <option value="0.85" selected>15% luzu</option>
          <option value="0.9">10% luzu</option>
        </select>
      </div>
    </div>
    <button onclick="calc()">Oblicz</button>

    <div class="result" id="result"></div>
  </div>

  <div class="card small muted">
    <p class="mono">
      Recepta: <strong>2C : 4P : 3T</strong> (C=cement, P=piasek, T=tłuczeń).<br>
      1 „porcja” = 9 miarek → po zagęszczeniu i wodzie daje ~ (9 × pojemność_miarki / 1.52) l betonu.
    </p>
  </div>

  <script>
    const roundTo = (x, step)=> Math.round(x/step)*step; // zaokrąglanie

    function toCm(val, units){ return units==='in' ? val*2.54 : val; }

    function calc(){
      const units = document.getElementById('units').value;
      let d = parseFloat(document.getElementById('diameter').value);
      let h = parseFloat(document.getElementById('depth').value);
      const measure = parseFloat(document.getElementById('measure').value);
      const bucket = parseFloat(document.getElementById('bucket').value);
      const headroom = parseFloat(document.getElementById('headroom').value);
      const safeCap = bucket*headroom;

      if([d,h,measure,bucket].some(v=>isNaN(v)||v<=0)){
        document.getElementById('result').innerHTML = "<p class='mono bad'>Podaj poprawne wartości.</p>";
        return;
      }

      d = toCm(d, units);
      h = toCm(h, units);

      // Walec – objętość w litrach
      const V = 0.000785 * d * d * h; // litry
      const litry = V.toFixed(1);

      // Wydajność jednej porcji (na 9 miarek)
      const portionYield = (9 * measure) / 1.52;
      const portionsExact = V / portionYield;
      const full = Math.floor(portionsExact);
      const rem = portionsExact - full;

      // Łączne miarki składników
      const C_total = full*2 + (rem*9)*(2/9);
      const P_total = full*4 + (rem*9)*(4/9);
      const T_total = full*3 + (rem*9)*(3/9);

      // Zaokrąglij do 0.5 miarki
      const C_r = roundTo(C_total, 0.5);
      const P_r = roundTo(P_total, 0.5);
      const T_r = roundTo(T_total, 0.5);

      // Czy jedno mieszanie w wybranym wiadrze wystarczy?
      const oneBatchOK = V <= safeCap;
      const mixes = Math.max(1, Math.ceil(V / safeCap));

      // Plan mieszań
      const plan = [];
      let C_left = C_r, P_left = P_r, T_left = T_r, V_left = V;
      for(let i=0;i<mixes;i++){
        const remainingSplits = mixes - i;
        const share = 1/remainingSplits;
        const C_i = roundTo(C_left*share, 0.5);
        const P_i = roundTo(P_left*share, 0.5);
        const T_i = roundTo(T_left*share, 0.5);
        const V_i = +(V_left*share).toFixed(1);

        plan.push({ idx:i+1, liters:V_i, C:C_i, P:P_i, T:T_i });

        C_left = Math.max(0, C_left - C_i);
        P_left = Math.max(0, P_left - P_i);
        T_left = Math.max(0, T_left - T_i);
        V_left = Math.max(0, V_left - V_i);
      }

      let bucketMsg = oneBatchOK
        ? `<span class="ok">Jedno mieszanie w wiadrze ${bucket} l wystarczy</span> (realny limit ~${safeCap.toFixed(0)} l).`
        : `<span class="warn">Jedno mieszanie w wiadrze ${bucket} l to za mało</span> (realny limit ~${safeCap.toFixed(0)} l). Zrób <strong>${mixes}</strong> mieszan${mixes===1?'ie':(mixes>=5?'ia':'y')}.`;

      let html = `
        <p><strong>Objętość betonu:</strong> ${litry} l</p>
        <p>Wydajność 1 porcji (2C:4P:3T, razem 9 miarek): ~${portionYield.toFixed(1)} l → potrzeba <strong>${portionsExact.toFixed(2)}</strong> porcji (pełne: ${full}, reszta: ${rem.toFixed(2)}).</p>
        <p><strong>Łącznie na 1 słupek:</strong> C=${C_r.toFixed(1)} miarek, P=${P_r.toFixed(1)} miarek, T=${T_r.toFixed(1)} miarek (pojemność = ${measure} l).</p>
        <p>${bucketMsg}</p>
      `;

      html += `<table><thead><tr><th>Mieszanie</th><th>Docelowo (l)</th><th>C</th><th>P</th><th>T</th></tr></thead><tbody>`;
      plan.forEach(b=>{
        html += `<tr><td>#${b.idx}</td><td>${b.liters}</td><td>${b.C}</td><td>${b.P}</td><td>${b.T}</td></tr>`;
      });
      html += `</tbody></table>`;

      html += `<p class="small muted">Wskazówka: trzymaj konsystencję gęstoplastyczną (nie „zupa”). Lej warstwami po 15–20 cm, każdą warstwę zagęść kijem/prętem.</p>`;

      document.getElementById('result').innerHTML = html;
    }
  </script>
</body>
</html>
